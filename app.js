// נומרולוגיה יומית - לוגיקה ראשית

class NumerologyApp {
  constructor() {
    this.elements = {
      dateInput: document.getElementById('dateInput'),
      todayBtn: document.getElementById('todayBtn'),
      energyNumber: document.getElementById('energyNumber'),
      title: document.getElementById('title'),
      summary: document.getElementById('summary'),
      focusList: document.getElementById('focusList'),
      avoidList: document.getElementById('avoidList'),
      shareBtn: document.getElementById('shareBtn'),
      installBtn: document.getElementById('installBtn')
    };
    
    this.deferredPrompt = null;
    this.init();
  }
  
  init() {
    this.setTodayDate();
    this.bindEvents();
    this.registerServiceWorker();
    this.handleInstallPrompt();
    this.calculateEnergy();
  }
  
  setTodayDate() {
    const today = new Date();
    const year = today.getFullYear();
    const month = String(today.getMonth() + 1).padStart(2, '0');
    const day = String(today.getDate()).padStart(2, '0');
    this.elements.dateInput.value = `${year}-${month}-${day}`;
  }
  
  bindEvents() {
    this.elements.dateInput.addEventListener('change', () => this.calculateEnergy());
    this.elements.todayBtn.addEventListener('click', () => {
      this.setTodayDate();
      this.calculateEnergy();
    });
    this.elements.shareBtn.addEventListener('click', () => this.shareReading());
    this.elements.installBtn.addEventListener('click', () => this.installApp());
  }
  
  calculateNumerology(dateString) {
    if (!dateString) return null;
    
    const [year, month, day] = dateString.split('-').map(Number);
    
    // חישוב סכום הספרות
    const sumDigits = (num) => {
      let sum = 0;
      while (num > 0) {
        sum += num % 10;
        num = Math.floor(num / 10);
      }
      return sum;
    };
    
    // צמצום למספר יחיד
    const reduceNumber = (num) => {
      while (num > 9) {
        num = sumDigits(num);
      }
      return num;
    };
    
    const daySum = sumDigits(day);
    const monthSum = sumDigits(month);
    const yearSum = sumDigits(year);
    
    const total = daySum + monthSum + yearSum;
    return reduceNumber(total);
  }
  
  getEnergyData(number) {
    const energies = {
      1: {
        title: 'יום של יוזמה ומנהיגות',
        summary: 'אנרגיה של התחלות חדשות, עצמאות ויצירתיות. מספר 1 מייצג את השורש, היצירה והמנהיגות. זהו יום מושלם להתחלות חדשות, קבלת החלטות חשובות ונטילת אחריות. האנרגיה הזו מעודדת ביטחון עצמי, יוזמה ויכולת להוביל.',
        spiritualMeaning: 'מספר 1 הוא התחלה של הכל - הוא מייצג את האלוהי, היצירה הראשונית והכוח הבלתי מוגבל. זהו יום לחיבור עם הכוח הפנימי שלך ולזכור שאתה יוצר את המציאות שלך.',
        psychologicalAspects: 'פסיכולוגית, מספר 1 מביא אנרגיה של ביטחון ואסרטיביות. הוא עוזר להתגבר על פחדים, לבנות אמונה עצמית ולהפוך רעיונות למציאות.',
        healthImpact: 'האנרגיה הזו תומכת בפעילות גופנית, שיפור בריאות הנפש דרך פעולה ובניית שרירים. היא מעודדת הפרשת אנדורפינים ומחזקת את המערכת החיסונית.',
        focus: [
          'התחלת פרויקטים חדשים - זה הזמן המושלם לזריעת זרעים',
          'קבלת החלטות חשובות - האינטואיציה שלך מחודדת במיוחד',
          'פיתוח יצירתיות אישית - הבע את הרעיונות הייחודיים שלך',
          'תכנון יעדים ארוכי טווח - הגדר חזון ברור לעתיד',
          'הובלת צוותים או קבוצות - אנשים יסתכלו אליך להכוונה',
          'פעילות גופנית מאומצת - שחרר אנרגיה עודפת דרך תנועה',
          'למידה של מיומנויות חדשות - הרחב את הידע והיכולות'
        ],
        avoid: [
          'תלות מוגזמת באחרים - סמוך על השיפוט שלך',
          'דחיית החלטות חשובות - זה עלול ליצור חסימות אנרגטיות',
          'פעילויות שגרתיות בלבד - אל תבזבז את האנרגיה החזקה הזו',
          'ויתור על רעיונות חדשים - הם עלולים להיות הזדמנויות זהב',
          'הימנעות מאחריות - זה יום של מנהיגות ונטילת אחריות'
        ]
      },
      2: {
        title: 'יום של שיתוף פעולה ואיזון',
        summary: 'אנרגיה של דיפלומטיה, שותפות ורגישות רגשית. מספר 2 מייצג איזון, הרמוניה ויכולת לעבוד עם אחרים. זהו יום מצוין לבניית קשרים, פתרון קונפליקטים והאזנה פעילה. האנרגיה הזו מביאה שלום פנימי ויכולת להבין את צרכי האחר.',
        spiritualMeaning: 'מספר 2 מייצג את הדואליות של החיים - יין ויאנג, גבר ואישה, שמיים וארץ. הוא מזכיר לנו שהכל מחובר ושיתוף פעולה הוא המפתח להרמוניה.',
        psychologicalAspects: 'פסיכולוגית, מספר 2 מביא רגישות רגשית ואמפתיה. הוא עוזר לפתח מיומנויות חברתיות, להבין את צרכי האחר ולהגיע לפשרות בריאות.',
        healthImpact: 'האנרגיה הזו תומכת בבריאות רגשית, מחזקת קשרים חברתיים ומפחיתה מתח. היא מעודדת פעילויות שקטות כמו יוגה או הליכה בטבע.',
        focus: [
          'בניית יחסים חדשים - אנשים ייפתחו אליך בקלות',
          'שיתופי פעולה ושותפויות - מצא שותפים לחלומות שלך',
          'פתרון קונפליקטים בדיפלומטיה - השתמש ברגישות שלך',
          'פעילויות קבוצתיות - עבודה בצוות תהיה פורה במיוחד',
          'האזנה פעילה לאחרים - תן מרחב לרגשות שלהם',
          'טיפוח יחסים קיימים - הזמן המושלם לתקשורת עמוקה',
          'פעילויות אומנותיות שיתופיות - ציור, מוזיקה או ריקוד בקבוצה'
        ],
        avoid: [
          'עבודה בבידוד מוחלט - אתה זקוק לאנרגיה של אחרים',
          'קבלת החלטות חפוזות - קח זמן להתייעץ עם אחרים',
          'עימותים ישירים - בחר דרכים עדינות יותר',
          'התעלמות מרגשות אחרים - זה עלול לפגוע בקשרים',
          'דחיפת סדר יום אישי - היה פתוח לצרכים של אחרים'
        ]
      },
      3: {
        title: 'יום של ביטוי עצמי ויצירתיות',
        summary: 'אנרגיה של תקשורת, אומנות ואופטימיות. מספר 3 מייצג ביטוי עצמי, יצירתיות וחיבור חברתי. זהו יום מושלם להבעת רעיונות, יצירה אומנותית ומפגשים חברתיים. האנרגיה הזו מביאה שמחה, השראה ויכולת להפיץ אור לאחרים.',
        spiritualMeaning: 'מספר 3 מייצג את השילוש הקדוש - גוף, נפש ורוח. הוא מסמל את זרימת החיים, הצמיחה וההתרחבות. זהו יום לחיבור עם היצירתיות האלוהית.',
        psychologicalAspects: 'פסיכולוגית, מספר 3 מביא אופטימיות ואנרגיה חיובית. הוא עוזר להתגבר על דיכאון, לבנות ביטחון בביטוי עצמי ולפתח מיומנויות חברתיות.',
        healthImpact: 'האנרגיה הזו תומכת בבריאות הנפש, מעודדת הפרשת סרוטונין ומחזקת את המערכת החיסונית. היא מושלמת לפעילויות שמחות ויצירתיות.',
        focus: [
          'פעילויות יצירתיות ואומנותיות - צייר, כתוב, צלם או נגן',
          'תקשורת פתוחה וכנה - הבע את הרגשות והמחשבות שלך',
          'מפגשים חברתיים - סביבה חברתית תגביר את האנרגיה',
          'כתיבה או הרצאות - שתף את הידע והחוויות שלך',
          'הבעה של רעיונות חדשים - אל תפחד להיות שונה',
          'פעילויות מהנות - צחוק ותענוג יגבירו את האנרגיה',
          'יצירה עם ילדים או בעלי חיים - אנרגיה טהורה ומהנה'
        ],
        avoid: [
          'דיכוי רגשות ורעיונות - זה יחסום את זרימת האנרגיה',
          'פעילויות משעממות - בחר דברים שמביאים לך שמחה',
          'ביקורת מוגזמת על עצמך - היה סלחני וחיובי',
          'הימנעות ממפגשים חברתיים - בדידות תחליש את האנרגיה',
          'דיבור לשטיחי של אחרים - היה כן אבל עדין'
        ]
      },
      4: {
        title: 'יום של עבודה קשה וארגון',
        summary: 'אנרגיה של משמעת, יסודיות ובניית בסיסים חזקים. מספר 4 מייצג יציבות, עבודה קשה וארגון. זהו יום מצוין להתמקד בפרטים, לבנות שגרות יעילות ולהשלים משימות. האנרגיה הזו מביאה תחושת הישג והגשמה.',
        spiritualMeaning: 'מספר 4 מייצג את ארבעת היסודות - אדמה, אוויר, אש ומים. הוא מסמל יציבות, אמינות ובניית יסודות חזקים. זהו יום לחיבור עם העולם הפיזי.',
        psychologicalAspects: 'פסיכולוגית, מספר 4 מביא משמעת ומחויבות. הוא עוזר להתגבר על עצלנות, לבנות שגרות בריאות ולהשיג מטרות ארוכות טווח.',
        healthImpact: 'האנרגיה הזו תומכת בבריאות פיזית, מחזקת את הגוף דרך עבודה קשה ומחזקת את העצמות והשרירים. היא מעודדת שינה מסודרת וארוחות בריאות.',
        focus: [
          'ארגון והסדרת משימות - צור רשימות ותוכניות ברורות',
          'עבודה מפורטת ויסודית - התמקד באיכות על פני כמות',
          'בניית שגרות יעילות - צור הרגלים שיתמכו בך',
          'ניהול כספים וחסכון - תכנן את העתיד הפיננסי שלך',
          'השלמת פרויקטים ארוכי טווח - הגיע הזמן לקצור פירות',
          'עבודה פיזית - גינון, בנייה או ספורט מאמץ',
          'למידה מעשית - מיומנויות שימושיות ופרקטיות'
        ],
        avoid: [
          'שינויים פתאומיים בתוכניות - שמור על יציבות',
          'התחלת פרויקטים חדשים - התמקד בהשלמה',
          'פעילויות ספונטניות - עקוב אחר התוכנית',
          'התעלמות מפרטים חשובים - הם קריטיים להצלחה',
          'חוסר סבלנות עם תהליכים - דברים טובים לוקחים זמן'
        ]
      },
      5: {
        title: 'יום של חופש והרפתקאות',
        summary: 'אנרגיה של שינוי, גיוון וחקירה. מספר 5 מייצג חופש, הרפתקאות ושינויים. זהו יום מושלם להרחבת אופקים, למידה חדשה ופגישה עם אנשים חדשים. האנרגיה הזו מביאה התחדשות והתלהבות מחיים.',
        spiritualMeaning: 'מספר 5 מייצג את חמשת החושים והחירות הרוחנית. הוא מסמל שינוי, התפתחות והרחבת התודעה. זהו יום לחיבור עם הרוח החופשית שבך.',
        psychologicalAspects: 'פסיכולוגית, מספר 5 מביא התלהבות וסקרנות. הוא עוזר להתגבר על שגרה, לפתח גמישות מחשבתית ולהרחיב את האופקים.',
        healthImpact: 'האנרגיה הזו תומכת בבריאות דרך תנועה ושינוי. היא מעודדת פעילות גופנית מגוונת, נסיעות וחוויות חדשות שמחזקות את הגוף והנפש.',
        focus: [
          'נסיעות וחקירת מקומות חדשים - צא להרפתקאות',
          'למידה של דברים חדשים - קורסים, סדנאות או ספרים',
          'פגישה עם אנשים חדשים - הרחב את המעגל החברתי',
          'שינויים חיוביים בשגרה - שנה הרגלים ישנים',
          'פעילויות הרפתקניות - ספורט אתגרי או טיולים',
          'ניסוי עם מזון חדש - הרפתקאות קולינריות',
          'שינויי מראה - שיער, בגדים או איפור חדש'
        ],
        avoid: [
          'דבקות קיצונית בשגרה - הרשה לעצמך חופש',
          'הימנעות מהזדמנויות חדשות - הן יביאו צמיחה',
          'עבודה משעממת וחוזרת - מצא דרכים חדשות לעשות דברים',
          'הגבלות מיותרות - אל תכבול את עצמך',
          'פחד משינויים - הם חלק מהחיים'
        ]
      },
      6: {
        title: 'יום של אהבה ואחריות',
        summary: 'אנרגיה של דאגה, טיפוח והיענות לצרכי אחרים. מספר 6 מייצג אהבה, משפחה ואחריות. זהו יום מצוין לטיפוח יחסים, עזרה לאחרים ויצירת אווירה חמה. האנרגיה הזו מביאה הרמוניה ותחושת שייכות.',
        spiritualMeaning: 'מספר 6 מייצג אהבה ללא תנאי והרמוניה משפחתית. הוא מסמל את האיזון בין לתת ולקבל, והחיבור בין בני האדם. זהו יום לחיבור עם האהבה האלוהית.',
        psychologicalAspects: 'פסיכולוגית, מספר 6 מביא רגשי חום ואמפתיה. הוא עוזר לפתח מיומנויות טיפול, לבנות קשרים משפחתיים חזקים ולהרגיש שייכות.',
        healthImpact: 'האנרגיה הזו תומכת בבריאות רגשית ופיזית. היא מעודדת טיפוח עצמי, בישול בריא ויצירת סביבה תומכת שמחזקת את המערכת החיסונית.',
        focus: [
          'טיפוח יחסים משפחתיים - הקדש זמן לאהובים',
          'עזרה לאחרים - תן בלי לצפות לתמורה',
          'פעילויות בקהילה - התנדבות או עזרה לשכנים',
          'יצירת אווירה חמה בבית - ניקיון, בישול, עיצוב',
          'השקעה ברווחת אחרים - תמיכה רגשית ופיזית',
          'טיפוח בעלי חיים - אמץ או טפל בבעלי חיים',
          'פעילויות משפחתיות - משחקים, ארוחות משותפות'
        ],
        avoid: [
          'התעלמות מצרכי המשפחה - הם זקוקים לך',
          'אנוכיות מוגזמת - חשוב על טובת הכלל',
          'הימנעות מאחריות - קח אחריות על חייך',
          'קונפליקטים עם יקירים - בחר אהבה על פני צדק',
          'הזנחת הבית והסביבה - הם משקפים את הפנימיות שלך'
        ]
      },
      7: {
        title: 'יום של חכמה ומחשבה עמוקה',
        summary: 'אנרגיה של התבוננות פנימית, למידה ורוחניות. מספר 7 מייצג חכמה, התבוננות ואנליזה. זהו יום מצוין למדיטציה, למידה עמוקה וחיפוש תובנות. האנרגיה הזו מביאה בהירות מחשבתית ושלווה פנימית.',
        spiritualMeaning: 'מספר 7 הוא מספר קדוש רבים בתרבויות - הוא מייצג את ההתבוננות הרוחנית והחיבור עם החכמה הגבוהה. זהו יום לחיפוש משמעות עמוקה.',
        psychologicalAspects: 'פסיכולוגית, מספר 7 מביא ריכוז וניתוח עמוק. הוא עוזר לפתח תובנות, להבין דפוסים מורכבים ולהגיע להבנה עמוקה יותר של עצמך והעולם.',
        healthImpact: 'האנרגיה הזו תומכת בבריאות הנפש דרך התבוננות ושלווה. היא מעודדת מדיטציה, שינה איכותית ופעילויות שקטות שמרפאות את הנפש.',
        focus: [
          'מדיטציה והתבוננות - התחבר לעצמך ברמה עמוקה',
          'למידה עמוקה ומחקר - קרא ספרים, למד תיאוריות',
          'פעילויות רוחניות - יוגה, טאי צ\'י או תפילה',
          'זמן איכות עם עצמך - הליכות בטבע או כתיבה יומן',
          'חיפוש תובנות חדשות - שאל שאלות גדולות',
          'פעילויות יצירתיות שקטות - ציור או מוזיקה שקטה',
          'למידה עצמית - קורסים אונליין או ספרים'
        ],
        avoid: [
          'החלטות חפוזות - קח זמן לחשוב לעומק',
          'מפגשים חברתיים רבים - אתה זקוק לזמן לבד',
          'פעילויות שטחיות - התמקד בעומק על פני רוחב',
          'הימנעות מהתבוננות עצמית - זה הזמן להכיר את עצמך',
          'עומס חברתי מוגזם - שמור על אנרגיה שקטה'
        ]
      },
      8: {
        title: 'יום של הצלחה ומימוש יעדים',
        summary: 'אנרגיה של כוח, הישגים ומנהיגות. מספר 8 מייצג הצלחה, כוח ושפע. זהו יום מצוין להתמקד בקריירה, השגת יעדים והרחבת השפעה. האנרגיה הזו מביאה ביטחון והגשמה.',
        spiritualMeaning: 'מספר 8 מייצג אינסוף וכוח בלתי מוגבל. הוא מסמל את זרימת השפע וההצלחה. זהו יום לחיבור עם הכוח הפנימי והיכולת להשפיע על העולם.',
        psychologicalAspects: 'פסיכולוגית, מספר 8 מביא מוטיבציה והתמדה. הוא עוזר לפתח ביטחון, להגדיר יעדים ברורים ולהוביל שינויים משמעותיים.',
        healthImpact: 'האנרגיה הזו תומכת בכוח פיזי ומנטלי. היא מעודדת פעילות גופנית מאומצת, תזונה בריאה ואיזון בין עבודה למנוחה.',
        focus: [
          'פיתוח קריירה ועסקים - קח צעדים משמעותיים קדימה',
          'השגת יעדים כלכליים - תכנן השקעות וחסכונות',
          'נטילת אחריות גדולה - הובל פרויקטים חשובים',
          'בניית מוניטין מקצועי - הראה את היכולות שלך',
          'הובלת פרויקטים חשובים - קח אחריות על תוצאות',
          'פיתוח כישורי מנהיגות - למד מנהיגים מוצלחים',
          'הרחבת רשת קשרים מקצועית - פגוש אנשים משפיעים'
        ],
        avoid: [
          'הזנחת הבריאות בשביל העבודה - שמור על איזון',
          'התעלמות מיחסים אישיים - הם חשובים כמו הקריירה',
          'רדיפת כסף בלבד - זכור בערכים ותכלית',
          'שימוש לרעה בכוח - השתמש בו לטובת הכלל',
          'התעלמות מערכים רוחניים - הצלחה אמיתית כוללת הכל'
        ]
      },
      9: {
        title: 'יום של נתינה והשלמות',
        summary: 'אנרגיה של חמלה, שירות וסיום מחזורים. מספר 9 מייצג השלמה, נתינה וחמלה. זהו יום מצוין לעזרה לאחרים, סיום פרויקטים והערכת הישגים. האנרגיה הזו מביאה סיפוק ותחושת משמעות.',
        spiritualMeaning: 'מספר 9 מייצג השלמה והכנה למחזור חדש. הוא מסמל חמלה אינסופית וחיבור עם האנושות כולה. זהו יום לחיבור עם האהבה האלוהית.',
        psychologicalAspects: 'פסיכולוגית, מספר 9 מביא סיפוק והערכה עצמית. הוא עוזר לסיים מחזורים ישנים, להעריך הישגים ולפתח חמלה כלפי עצמך ואחרים.',
        healthImpact: 'האנרגיה הזו תומכת בריפוי רגשי ופיזי. היא מעודדת נתינה, חמלה והערכה שמחזקות את הלב והנפש.',
        focus: [
          'עזרה וחסד לזולת - תן בלי לצפות לתמורה',
          'סיום פרויקטים ארוכי טווח - הגיע הזמן לקצור פירות',
          'הערכת ההישגים שלך - חגוג את ההצלחות',
          'פעילות התנדבותית - תרום לקהילה שלך',
          'מתן השראה לאחרים - היה דוגמה לחיקוי',
          'סליחה ועזיבה מאחור - שחרר מה שלא משרת אותך',
          'פעילויות רוחניות של שירות - עזרה לנזקקים'
        ],
        avoid: [
          'אנוכיות והתמקדות בעצמך בלבד - חשוב על טובת הכלל',
          'התחלת פרויקטים חדשים גדולים - התמקד בסיום',
          'הימנעות מנתינה - זה יחסום את זרימת האנרגיה',
          'דבקות במה שעבר - שחרר ותן מקום לחדש',
          'רוגז או איבה - בחר באהבה ובחמלה'
        ]
      }
    };
    
    return energies[number] || null;
  }
  
  calculateEnergy() {
    const dateValue = this.elements.dateInput.value;
    if (!dateValue) return;
    
    const energyNumber = this.calculateNumerology(dateValue);
    
    if (energyNumber === null) return;
    
    const energyData = this.getEnergyData(energyNumber);
    if (!energyData) return;
    
    // עדכון המספר
    this.elements.energyNumber.textContent = energyNumber;
    
    // עדכון הכותרת והתיאור
    this.elements.title.textContent = energyData.title;
    this.elements.summary.textContent = energyData.summary;
    
    // הצגת פירוט נוסף
    const energyDetails = document.getElementById('energyDetails');
    const spiritualMeaning = document.getElementById('spiritualMeaning');
    const psychologicalAspects = document.getElementById('psychologicalAspects');
    const healthImpact = document.getElementById('healthImpact');
    
    if (energyData.spiritualMeaning) {
      spiritualMeaning.textContent = energyData.spiritualMeaning;
      psychologicalAspects.textContent = energyData.psychologicalAspects;
      healthImpact.textContent = energyData.healthImpact;
      energyDetails.style.display = 'block';
    } else {
      energyDetails.style.display = 'none';
    }
    
    // עדכון רשימת המומלץ
    this.elements.focusList.innerHTML = '';
    energyData.focus.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      this.elements.focusList.appendChild(li);
    });
    
    // עדכון רשימת המונע
    this.elements.avoidList.innerHTML = '';
    energyData.avoid.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      this.elements.avoidList.appendChild(li);
    });
  }
  
  async shareReading() {
    const dateValue = this.elements.dateInput.value;
    const energyNumber = this.elements.energyNumber.textContent;
    const title = this.elements.title.textContent;
    
    const shareData = {
      title: 'נומרולוגיה יומית',
      text: `אנרגיית היום (${dateValue}): ${energyNumber} - ${title}`,
      url: window.location.href
    };
    
    if (navigator.share) {
      try {
        await navigator.share(shareData);
      } catch (err) {
        console.log('שיתוף בוטל');
      }
    } else {
      // Fallback להעתקה
      const textToCopy = `${shareData.text}\n${shareData.url}`;
      try {
        await navigator.clipboard.writeText(textToCopy);
        alert('הטקסט הועתק ללוח!');
      } catch (err) {
        console.log('שגיאה בהעתקה', err);
      }
    }
  }
  
  handleInstallPrompt() {
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      this.deferredPrompt = e;
      this.elements.installBtn.hidden = false;
    });
    
    window.addEventListener('appinstalled', () => {
      this.elements.installBtn.hidden = true;
      this.deferredPrompt = null;
    });
  }
  
  async installApp() {
    if (!this.deferredPrompt) return;
    
    this.deferredPrompt.prompt();
    const result = await this.deferredPrompt.userChoice;
    
    if (result.outcome === 'accepted') {
      console.log('האפליקציה הותקנה');
    }
    
    this.deferredPrompt = null;
    this.elements.installBtn.hidden = true;
  }
  
  async registerServiceWorker() {
    if ('serviceWorker' in navigator) {
      try {
        await navigator.serviceWorker.register('./sw.js');
        console.log('Service Worker רשום בהצלחה');
      } catch (error) {
        console.log('שגיאה ברישום Service Worker:', error);
      }
    }
  }
}

// אתחול האפליקציה
document.addEventListener('DOMContentLoaded', () => {
  new NumerologyApp();
});
